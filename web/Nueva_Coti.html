te dare<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ingemat S.A.C - Nueva Cotización</title>
    <link rel="icon" href="logo.png" type="image/png">
    <link rel="stylesheet" href="CSS/estilo_menu.css">
    <link rel="stylesheet" href="CSS/barra_izquierda.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="CSS/estilo_N_Coti.css">
</head>
<body>
<aside class="barra_izq">
    <div class="barra_izq-icono">
        <img src="Imagenes/Usuario.png" alt="Avatar usuario">
    </div>
    <nav class="barra_izq-menu">
        <ul>
            <li><a href="S_Registrados.html"><i class="fas fa-home"></i>Servicios Registrados</a></li>
            <li><a href="Nueva_Coti.html" class="active"><i class="fas fa-file-invoice"></i>Nueva Cotización</a></li>
            <li><a href="Formatos.html"><i class="fas fa-file-alt"></i>Formatos</a></li>
            <li class="Cerrar"><a href="Login.html"><i class="fas fa-sign-out-alt"></i>Cerrar sesión</a></li>
        </ul>
    </nav>
</aside>

<main class="main-content">
    <div class="Contenido-Cotizacion">
        <h1>Generador de Cotización</h1>

        <form id="formCotizacion" action="CotizacionServlet" method="post">
            <section class="section">
                <h2>Datos de Cotización</h2>
                <div class="form-group">
                    <label for="motivo">Motivo:</label>
                    <input type="text" id="motivo" name="motivo" placeholder="Motivo del proyecto">
                </div>
                <div class="form-group">
                    <label for="solicitante">Solicitante:</label>
                    <input type="text" id="solicitante" name="solicitante" placeholder="Nombre del solicitante">
                </div>
                <div class="form-group">
                    <label for="rucDni">RUC / DNI:</label>
                    <input type="text" id="rucDni" name="rucDni" placeholder="Número de RUC o DNI">
                </div>
                <div class="form-group">
                    <label for="ubicacion">Ubicación:</label>
                    <input type="text" id="ubicacion" name="ubicacion" placeholder="Dirección o Localidad">
                </div>
                <div class="form-group">
                    <label for="fecha">Fecha:</label>
                    <input type="date" id="fecha" name="fecha">
                </div>
                <div class="form-group">
                    <label for="tipoCliente">Tipo de Cliente:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="tipoCliente" value="Empresa Publica"> Empresa Pública</label>
                        <label><input type="radio" name="tipoCliente" value="Empresa Privada"> Empresa Privada</label>
                        <label><input type="radio" name="tipoCliente" value="Cliente Independiente"> Cliente Independiente</label>
                    </div>
                </div>
            </section>

            <section class="section">
                <h2>Condiciones de Presupuesto</h2>
                <section class="section">
    <h2>Servicios a Cotizar</h2>
    <div class="form-group">
        <label for="servicios">Selecciona los servicios que deseas incluir:</label>
        <table id="tablaServicios">
            <thead>
                <tr>
                    <th>Seleccionar</th>
                    <th>Código</th>
                    <th>Nombre</th>
                    <th>Precio (S/)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Estos datos deberían cargarse dinámicamente desde la base de datos -->
                <tr>
                    <td><input type="checkbox" name="servicios" value="1"></td>
                    <td>COD-001</td>
                    <td>Supervisión de Proyecto</td>
                    <td>2500.00</td>
                </tr>
                <tr>
                    <td><input type="checkbox" name="servicios" value="2"></td>
                    <td>COD-002</td>
                    <td>Elaboración de Estudio</td>
                    <td>1800.00</td>
                </tr>
                <!-- Más filas dinámicamente generadas -->
            </tbody>
        </table>
    </div>
</section> 
                <div class="form-group">
                    <label for="tiempoEjecucion">Tiempo de ejecución:</label>
                    <input type="text" id="tiempoEjecucion" name="tiempoEjecucion">
                </div>
                <div class="form-group">
                    <label for="formaPago">Forma de Pago:</label>
                    <select id="formaPago" name="formaPago">
                        <option value="">Seleccione una opción</option>
                        <option value="Contado">Contado</option>
                        <option value="Crédito">Crédito</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="tipoMoneda">Tipo de Moneda:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="tipoMoneda" value="S/" checked> S/ (Soles)</label>
                        <label><input type="radio" name="tipoMoneda" value="$"> $ (Dólares)</label>
                    </div>
                </div>
            </section>

            <!-- Campo oculto para guardar el ID de la cotización -->
            <input type="hidden" id="idCotiGenerada" name="idCotiGenerada">

            <div class="btn-group section-full">
                <button type="submit" class="btn btn-secondary" name="accion" value="guardar">Guardar Cotización</button>
                <button type="submit" class="btn btn-success" name="accion" value="generar">Generar Cotización</button>
                <button type="button" class="btn btn-primary" onclick="enviarOrden()">Orden de Servicio</button>
            </div>
        </form>
    </div>
</main>

<script>
function enviarOrden() {
    const form = document.getElementById("formCotizacion");
    const formData = new FormData(form);
    formData.append("accion", "guardar"); // Siempre guardar antes de ir a orden

    fetch("CotizacionServlet", {
        method: "POST",
        body: formData
    })
    .then(response => response.json()) // Espera un JSON con el idCotizacion
    .then(data => {
        if (data.idCotizacion) {
            window.location.href = "OrdenServicioServlet?idCoti=" + data.idCotizacion;
        } else {
            alert("No se pudo generar la cotización. Verifica los datos.");
        }
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Hubo un error al generar la orden.");
    });
}
</script>

</body>
</html>
